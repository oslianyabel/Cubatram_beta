{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block extracss %}
<link rel="stylesheet" href="{% static 'app/css/home6.css' %}">
{% endblock %}

{% block destinations_options %}
    {% for destination in destinations %}
        <option value="{{ destination.slug }}">{{ destination.name }}</option>
    {% endfor %}
{% endblock %}

{% block category_options %}
    {% for category in categories %}
        <option value="{{ category.slug }}">{{ category.title }}</option>
    {% endfor %}
{% endblock category_options %}

{% block content %}
    <section class="cards">
        {% for destination in featured_destinations %}
            <a href="{% url 'destination_selected' destination.slug %}" class="card" style="background-image: url('{% if destination.image %}{{ destination.image.url }}{% else %}{% static 'img/card.png' %}{% endif %}');">
                <h1 class="card-title">{{ destination.name }}</h1>
                <button class="card-btn">{% trans "View Tours" %}</button>
            </a>
        {% empty %}
            <div class="card" style="background-image: url('{% static 'img/card.png' %}');">
                <h1 class="card-title">Antigua Tours</h1>
                <button class="card-btn">{% trans "View Tours" %}</button>
            </div>
            <div class="card" style="background-image: url('{% static 'img/card.png' %}');">
                <h1 class="card-title">Barbados Tours</h1>
                <button class="card-btn">{% trans "View Tours" %}</button>
            </div>
            <div class="card" style="background-image: url('{% static 'img/card.png' %}');">
                <h1 class="card-title">St. Lucia Tours</h1>
                <button class="card-btn">{% trans "View Tours" %}</button>
            </div>
        {% endfor %}
    </section>
{% endblock %}

{% block footer-logo %}
    <a href="{% url 'home' %}" class="fixed-logo" style="background-image: url('{% static 'svg/logo_footer.svg' %}');"></a>
{% endblock %}

{% block extrajs %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const destinationSelect = document.getElementById('destination-select');
    const categorySelect = document.getElementById('category-select');
    const findTourBtn = document.getElementById('find-tour-btn');

    // Datos de categorías por destino
    const categoriesByDestination = {
        {% for destination in destinations %}
            '{{ destination.slug }}': [
                {% for category in destination.categories.all %}
                    {slug: '{{ category.slug }}', title: '{{ category.title }}'}{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]{% if not forloop.last %},{% endif %}
        {% endfor %}
    };

    // Función para actualizar las opciones de categoría y seleccionar la primera
    function updateCategoryOptions(destinationSlug) {
        categorySelect.innerHTML = ''; // Limpiar opciones
        
        if (destinationSlug && categoriesByDestination[destinationSlug]) {
            const categories = categoriesByDestination[destinationSlug];
            
            // Agregar todas las categorías y seleccionar la primera
            categories.forEach((category, index) => {
                const option = document.createElement('option');
                option.value = category.slug;
                option.textContent = category.title;
                categorySelect.appendChild(option);
                
                // Seleccionar la primera categoría automáticamente
                if (index === 0) {
                    option.selected = true;
                }
            });
        }
    }

    // Event listener para cambios en el select de destino
    destinationSelect.addEventListener('change', function() {
        updateCategoryOptions(this.value);
    });

    // Inicializar con la primera categoría del primer destino (si existe)
    if (destinationSelect.value) {
        updateCategoryOptions(destinationSelect.value);
    }
});
</script>
{% endblock %}